<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NAME CARD LIST</title>
  <link rel="stylesheet" href="./reset.css">
  <link rel="stylesheet" href="./main.css">
  <!-- <script src="./main.js" defer></script> -->
</head>

<body>

  <div class="wrapper clearfix">
    <h1>NAMECARD</h1>
    <div class="newInfo">
      <h2>NAMECARD EDIT</h2>
      <input type="text" class="newName" placeholder="이름">
      <input type="text" class="newCompany" placeholder="회사">
      <input type="text" class="newDivision" placeholder="부서">
      <input type="text" class="newEmail" placeholder="이메일주소">
      <input type="text" class="newMobile" placeholder="핸드폰번호">
      <button class="submitBtn">등록</button>
    </div>

    <div class="namecardList">
      <h2>NAMECARD LIST</h2>
      <ul class="sortList">
        <li class="sortName">이름순</li>
        <li class="sortCompany">회사순</li>
        <li class="sortRecent">최신등록순</li>
      </ul>

      <ul class="cardList clearfix">
        <!-- <li class="namecard color1">
          <div class="namecardInfo">
            <span class="cardName">홍길동</span>
            <span class="cardMobile">010-1354-4645</span>
            <span class="cardEmail">abd@kakaobank.co.kr</span>
          </div>
          <div class="namecardCompany">
            <span class="cardCompany">카카오뱅크</span>
            <span class="cardDivision">UX디자인팀</span>
          </div>
          <button class="deleteBtn">X</button>
        </li>
        <li class="namecard color2">
          <div class="namecardInfo">
            <span class="cardName">홍길동</span>
            <span class="cardMobile">010-1354-4645</span>
            <span class="cardEmail">abd@kakaobank.co.kr</span>
          </div>
          <div class="namecardCompany">
            <span class="cardCompany">카카오뱅크</span>
            <span class="cardDivision">UX디자인팀</span>
          </div>
          <button class="deleteBtn">X</button>
        </li> -->
      </ul>
    </div>
  </div>

  <script>
    let cardDatabase = [];
    const $newInfo = document.querySelector('.newInfo');
    const $newName = document.querySelector('.newName');
    const $newCompany = document.querySelector('.newCompany');
    const $newDivision = document.querySelector('.newDivision');
    const $newEmail = document.querySelector('.newEmail');
    const $newMobile = document.querySelector('.newMobile');
    const $submitBtn = document.querySelector('.submitBtn');
    const $cardList = document.querySelector('.cardList');

    function cardListHtml(name, mobile, email, company, division) {
      return `<li class="namecard color2">
          <div class="namecardInfo">
            <span class="cardName">${name}</span>
            <span class="cardMobile">${mobile}</span>
            <span class="cardEmail">${email}</span>
          </div>
          <div class="namecardCompany">
            <span class="cardCompany">${company}</span>
            <span class="cardDivision">${division}</span>
          </div>
          <button class="deleteBtn">X</button>
        </li>`;
    }

    const regExpEmail = /^[A-Za-z0-9]{8, 10}*@[A-Za-z0-9]*\.[a-zA-Z]{2,3}$/;
    const regExpMobile = /^\d{3}-\d{4}-\d{4}$/;

    $submitBtn.onclick = e => {
      const newInfoArray = [...$newInfo.children].filter(newInfo => newInfo.nodeName === 'INPUT');
      const newInfoBlank = newInfoArray.filter(newInfo => newInfo.value.length === 0).length === 0;
      const newInfoValues = newInfoArray.map(newInfo => newInfo.value);
      let [name, company, division, email, mobile] = newInfoValues;

      if (!newInfoBlank) {
        alert('빈칸을 채워주세요');
        return;
      };

      // if (!regExpEmail.test($newEmail.value)) {
      //   alert('이메일을 재작성하세요');
      //   return;
      // };

      // if (!regExpMobile.test($newMobile.value)) {
      //   alert('번호를 재작성하세요');
      //   return;
      // };

      cardDatabase = [...cardDatabase, {
        name,
        company,
        division,
        email,
        mobile
      }]
      console.log(cardDatabase);

      $cardList.innerHTML += cardListHtml($newName.value, $newMobile.value, $newEmail.value, $newCompany.value,
        $newDivision.value);

      newInfoArray.forEach(newInfo => newInfo.value = '');
    };

    $cardList.onclick = e => {
      if (e.target.matches('.deleteBtn')) {
        $cardList.removeChild(e.target.parentNode);
      }
    };

    const $sortName = document.querySelector('.sortName');
    const $sortCompany = document.querySelector('.sortCompany');
    const $sortRecent = document.querySelector('.sortRecent');

    function sortBy(key) {
      return cardDatabase.sort((a, b) => (a[key] > b[key] ? 1 : (a[key] < b[key] ? -1 : 0)));
    }

    $sortName.onclick = () => {
      console.log(sortBy('name'));
      let html = '';

      console.log($cardList.innerhtml);
      cardDatabase.forEach(data => {
        html += cardListHtml(data.name, data.mobile, data.email, data.company, data.division);
      });

      $cardList.innerHTML = html;
    };

    $sortCompany.onclick = () => {
      console.log(sortBy('company'));
      let html = '';

      cardDatabase.forEach(data => {
        html += cardListHtml(data.name, data.mobile, data.email, data.company, data.division);
      });

      $cardList.innerHTML = html;
    };

    $sortRecent.onclick = () => {
      console.log(cardDatabase.reverse());
      let html = '';

      cardDatabase.forEach(data => {
        html += cardListHtml(data.name, data.mobile, data.email, data.company, data.division);
      });

      $cardList.innerHTML = html;
    };
  </script>
</body>

</html>